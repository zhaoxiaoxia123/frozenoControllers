<div id="content">
    <sa-widgets-grid>
        <div class="row">
            <article class="col-sm-12 ">
                <sa-widget [editbutton]="false" [deletebutton]="false" [colorbutton]="false">
                    <header>
                        <nav>
                            <div class="nav nav-tabs" >
                                <a class="nav-item nav-link active" data-toggle="tab" role="tab" aria-selected="true" (click)="selectSearchState(0,0,0,3)">全部订单</a>
                                <a class="nav-item nav-link" data-toggle="tab" role="tab" aria-selected="false" (click)="selectSearchState(0,0,6,3)">仅退款(未发货)</a>
                                <a class="nav-item nav-link" data-toggle="tab" role="tab" aria-selected="false" (click)="selectSearchState(0,0,14,3)">退货退款(已发货)</a>
                                <a class="nav-item nav-link" data-toggle="tab" role="tab" aria-selected="false" (click)="selectSearchState(0,0,8,3)">维修</a>
                                <a class="nav-item nav-link" data-toggle="tab" role="tab" aria-selected="false" (click)="selectSearchState(0,0,9,3)">换货</a>
                                <a class="nav-item nav-link" data-toggle="tab" role="tab" aria-selected="false" (click)="selectSearchState(0,0,10,3)">补寄</a>
                            </div>
                        </nav>
                    </header>
                    <div>
                        <div class="widget-body no-padding">
                            <article>
                                <div class="navbar navbar-default" style="width:100%;border-bottom:1px solid #e2e3e5;">
                                    <form  class="navbar-form" role="search"  >
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                状态：{{search_array[search_index]['value']}}
                                            </button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" *ngFor="let s of search_array;let ind=index;" (click)="selectSearchState(ind,s.key,0,1)">{{s.value}}</a>
                                            </div>
                                        </div>
                                        <div class="btn-group" (click)="showVerify()">
                                            <button type="button" class="btn btn-primary" ><span class="fa-fw fa fa-stop mr-5 "></span>审核</button>
                                        </div>
                                        <div class="btn-group">
                                            <button type="button" [ngClass]="{'btn btn-success':true,'not-click':orderId == 0}" (click)="getOrderInfo()"><span class="fa-fw fa fa-list-alt mr-5"></span>详情</button>
                                        </div>
                                    </form>
                                    <form  class="navbar-form" novalidate="" role="search">
                                        <div class="btn-group">
                                            <input type="text" class="form-control" maxlength="15" [(ngModel)]="keyword" [ngModelOptions]="{standalone: true}" placeholder="请输入搜索内容" (keyup)="($event.which === 13) ? getOrderList(1) : 0">
                                        </div>
                                        <div class="btn-group">
                                            <button type="button" class="btn default-btn" (click)="selectSearchState(0,0,0,2)">搜索</button>
                                        </div>
                                    </form>
                                </div>
                            </article>
                            <div style="padding:0;">
                                <div class="table-scrolling padding0 printonly">
                                    <table class="table table-striped smart-form table-height-20">
                                        <thead>
                                        <tr>
                                            <th>单据状态</th>
                                            <th>订单编号</th>
                                            <th>买家名称</th>
                                            <th>交易金额</th>
                                            <th>退款金额</th>
                                            <!--<th>原因</th>-->
                                            <th>商品明细</th>
                                            <th>退货物流 </th>
                                            <th>退货物流单号</th>
                                            <th>新增订单号</th>
                                            <th>退款状态</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr *ngFor="let dl of orderList?.result?.data;let ind = index;" (click)="isStatusShow(dl.o_id)" [ngClass]="{'table-color':orderId == dl.o_id}">
                                            <td>
                                                <!--审核中  已同意  已拒绝 已作废-->
                                                <span [ngSwitch]="dl.frozeno_is_verify">
                                                    <span class="label-blue" *ngSwitchCase="1">审核中</span>
                                                    <span class="label-blue" *ngSwitchCase="2">已同意</span>
                                                    <span class="label-normal" *ngSwitchCase="3">已拒绝</span>
                                                    <span class="label-unknown" *ngSwitchDefault>正常状态</span>
                                                </span>
                                            </td>
                                            <td>{{dl.o_order}}</td>
                                            <td>{{dl.c_name}} {{dl.c_phone}}</td>
                                            <td>{{dl.frozeno_order_amount}}</td>
                                            <td>{{dl.notes?.apply_amount}}</td>
                                            <!--<td>{{ dl.notes?.reason}}</td>-->
                                            <td data-toggle="tooltip" data-placement="top" title="{{dl.order_name}}">{{dl.order_name}}</td>
                                            <td>{{dl.notes?.express_company}}</td>
                                            <td>{{dl.notes?.express_code}}</td>
                                            <td>{{dl.notes?.order}}</td>
                                            <td>
                                                <span [ngSwitch]="dl.frozeno_order_state">
                                                    <span class="label-normal" *ngSwitchCase="6">仅退款</span>
                                                    <span class="label-blue" *ngSwitchCase="14">退货退款</span>
                                                    <span class="label-blue" *ngSwitchCase="7">完成退款</span>
                                                    <span class="label-full" *ngSwitchCase="8">需维修</span>
                                                    <span class="label-full" *ngSwitchCase="9">需换货</span>
                                                    <span class="label-full" *ngSwitchCase="10">需补寄</span>
                                                    <span class="label-blue" *ngSwitchCase="11">维修完成</span>
                                                    <span class="label-blue" *ngSwitchCase="12">换货完成</span>
                                                    <span class="label-blue" *ngSwitchCase="13">补寄完成</span>
                                                    <span class="label-unknown" *ngSwitchDefault>未知</span>
                                                </span>
                                            </td>
                                        </tr>
                                        </tbody>
                                        <tbody *ngIf="orderList?.result?.total == 0">
                                            <tr style="text-align: center;">
                                                <td colspan="10">没有数据。</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- 底部-（分页部分）-->
                            <div class="footer-size flex-justify-end">
                                <ul class="pagination" *ngIf="orderList?.page" >
                                    <li *ngFor="let p of orderList?.page" class="{{p.class}}">
                                        <a class="page-link" (click)="pagination(p.value)" *ngIf="p.method=='method'">{{p.text}}</a>
                                        <a class="page-link" *ngIf="p.method==''">{{p.text}}</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link" disabled>共{{orderList.result?.total}}条</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </sa-widget>
            </article>
        </div>
    </sa-widgets-grid>
</div>

<!--详情-->
<div class="modal fade" bsModal #lgModal="bs-modal" >
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">详情</h4>
                <button type="button" class="close" (click)="lgModal.hide()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-overflow-y">
                <div class="m-order">
                    <div class="alert alert-secondary" role="alert">
                        基本信息
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">订单编号：</span>{{orderInfo?.result?.o_order}}</div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">购买人：</span>{{orderInfo?.result?.c_name}}{{orderInfo?.result?.c_phone}}</div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">等级：</span>{{orderInfo?.result?.level_name}}</div>
                    </div>
                </div>
                <div class="m-order">
                    <div class="alert alert-secondary" role="alert">
                        订单信息
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-12"><span class="m-orderdetails-title">商品明细：</span>{{orderInfo?.result?.order_name}}</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-12 ">
                            <button type="button" class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">查看详情</button>
                        </div>
                    </div>
                    <div class="m-order">
                        <div class="collapse" id="collapseExample">
                            <!--商品明细-->
                            <!--</div>-->
                            <!--表格默认最少显示5行-->
                            <table class="table table-striped table-forum">
                                <thead>
                                <tr>
                                    <th scope="col">序号</th>
                                    <th scope="col">名称</th>
                                    <th scope="col">数量</th>
                                    <th scope="col">单价</th>
                                    <th scope="col">折扣</th>
                                    <th scope="col">折扣价</th>
                                    <th scope="col">金额</th>
                                </tr>
                                </thead>
                                <tbody>

                                <tr *ngFor="let pd of orderInfo?.result?.products;let ind = index;">
                                    <td>{{(ind+1)}}</td>
                                    <td>{{pd.category_desc}}</td>
                                    <td>{{pd.product_count}}</td>
                                    <td>{{pd.product_before_amount}}</td>
                                    <td>{{orderInfo?.result?.frozeno_customer_discount?orderInfo?.result?.frozeno_customer_discount:0}}折</td>
                                    <td *ngIf="orderInfo?.result?.frozeno_customer_discount">{{(pd.product_before_amount*(orderInfo?.result?.frozeno_customer_discount/100))| number:''}}</td>
                                    <td *ngIf="!orderInfo?.result?.frozeno_customer_discount">{{pd.product_before_amount}}</td>
                                    <td>{{pd.product_amount}}</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>{{orderInfo?.result?.totalAmount}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">运费：</span>¥ 0.00</div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">会员优惠：</span>¥ {{orderInfo?.result?.customer_discount_amount?orderInfo?.result?.customer_discount_amount:0}}</div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">优惠券：</span>¥{{orderInfo?.result?.ticket_amount?orderInfo?.result?.ticket_amount:0}}</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">智美豆抵扣</span>¥ {{orderInfo?.result?.frozeno_bean}} </div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">实付款（含运费）：</span>¥ {{orderInfo?.result?.frozeno_order_amount}}</div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">支付方式：</span>微信支付</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-4">
                            <span class="m-orderdetails-title">支付状态：</span>
                            <span [ngSwitch]="orderInfo?.result?.frozeno_order_state">
                                <span class="label-full" *ngSwitchCase="6">退款中</span>
                                <span class="label-full" *ngSwitchCase="14">退货退款</span>
                                <span class="label-full" *ngSwitchCase="7">已退款</span>
                                <span class="label-full" *ngSwitchCase="8">需维修</span>
                                <span class="label-full" *ngSwitchCase="9">需换货</span>
                                <span class="label-full" *ngSwitchCase="10">需补寄</span>
                                <span class="label-full" *ngSwitchCase="11">已维修</span>
                                <span class="label-full" *ngSwitchCase="12">已换货</span>
                                <span class="label-full" *ngSwitchCase="13">已补寄</span>
                                <span class="label-unknown" *ngSwitchDefault>未知</span>
                            </span>
                        </div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">下单时间：</span>{{orderInfo?.result?.created_at}}</div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">发货时间：</span>{{orderInfo?.result?.frozeno_send_time}}</div>
                    </div>
                </div>
                <!--申请退款才显示-->
                <div class="m-order" *ngIf="orderInfo?.result?.apply_detail">
                    <div class="alert alert-secondary" role="alert">
                        退款信息
                    </div>
                    <div class="row m-orderdetails">
                        <!--<div class="col-6 col-md-4"><span class="m-orderdetails-title">退款编号：</span>d45465465</div>-->
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">买家退款金额：</span>¥ {{orderInfo?.result?.apply_detail?.apply_amount}}</div>
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">退款申请时间：</span>{{orderInfo?.result?.apply_detail?.apply_date}}</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">退款时间：</span>{{orderInfo?.result?.apply_detail?.handle_date}}</div>
                        <!--已拒绝退款  退款处理中  已退款-->
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">退款状态：</span>
                            <span *ngIf="orderInfo?.result?.frozeno_is_verify == 1">申请中</span>
                            <span *ngIf="orderInfo?.result?.frozeno_is_verify == 2">已退还</span>
                            <span *ngIf="orderInfo?.result?.frozeno_is_verify == 3">拒绝退款</span>
                        </div>
                    </div>
                </div>
                <!--需要退货时显示-->
                <div class="m-order" *ngIf="orderInfo?.result?.apply_detail">
                    <div class="alert alert-secondary" role="alert">
                        退货信息
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-6"><span class="m-orderdetails-title">卖家：</span>深圳冻龄智美生物科技有限公司</div>
                        <div class="col-6 col-md-3"><span class="m-orderdetails-title">卖家邮编：</span>610020</div>
                        <div class="col-6 col-md-3"><span class="m-orderdetails-title">卖家电话：</span>400-002-8767</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-4"><span class="m-orderdetails-title">卖家手机：</span>18215569754</div>
                        <div class="col-6 col-md-8"><span class="m-orderdetails-title">卖家退货地址：</span>四川省成都市下南大街59号世代锦江国际酒店A座25楼</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-6"><span class="m-orderdetails-title">退货物流单号：</span>{{orderInfo?.result?.apply_detail?.express_code}}</div>
                        <div class="col-6 col-md-6"><span class="m-orderdetails-title">退货物流公司：</span>{{orderInfo?.result?.apply_detail?.express_company}}</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-6 col-md-6"><span class="m-orderdetails-title">买家退货时间 ：</span>{{orderInfo?.result?.apply_detail?.apply_date}}</div>
                    </div>
                </div>
                <!--审核信息-->
                <div class="m-order" *ngIf="orderInfo?.result?.apply_detail">
                    <div class="alert alert-secondary" role="alert">
                        审核信息
                    </div>
                    <!--仅退款(已发货) 退货退款(已发货) 维修 换货 补寄 显示-->
                    <div class="row m-orderdetails">
                        <div class="picture-img col-12 col-md-12">
                            <div class="picture-box" *ngFor="let img of orderInfo?.result?.apply_img">
                                <div class="picture-item-img">
                                    <img class="picture-item-imge" src="{{img}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row m-orderdetails">
                        <!--维修换货补寄-->
                        <div class="col-12 col-md-6"><span class="m-orderdetails-title">新增订单号：</span>{{orderInfo?.result?.apply_detail?.order}}</div>
                        <div class="col-12 col-md-12"><span class="m-orderdetails-title">完结时间：</span>{{orderInfo?.result?.apply_detail?.handle_date}}</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-12 col-md-12"><span class="m-orderdetails-title">买家备注信息：</span>{{orderInfo?.result?.apply_detail?.buyer_mark}}</div>
                    </div>
                    <div class="row m-orderdetails">
                        <div class="col-12 col-md-12"><span class="m-orderdetails-title">卖家处理记录：</span>{{orderInfo?.result?.apply_detail?.seller_mark}}</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" (click)="lgModal.hide()">返回</button>
            </div>
        </div>
    </div>
</div>
<!-- 审核 -->
<div class="modal fade" bsModal #verifyModal="bs-modal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">审核</h5>
                <button type="button" class="close" (click)="verifyModal.hide()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body  height-overflow-380">
                <form>
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">图片</h5>
                            <p class="card-text">仅支持JPG、GIF、PNG图片文件，且小于1M</p>
                            <div style="background:#f2f2f2;padding:8px;margin-bottom:10px;">
                                <span *ngIf="selectedImageUrl">
                                    <span class="picture-list" *ngFor="let img of selectedImageUrl;let ind = index;">
                                        <a class="fa fa-times-circle picture-a" style="display:block;" (click)="removeUpload(img.uploadID)"></a>
                                        <img width="90px" height="90px" src="{{img.url}}">
                                    </span>
                                </span>
                                <span *ngIf="path">
                                <span class="picture-list" *ngFor="let pi of path;let pind = index;">
                                    <img width="90px" height="90px" src="{{pi}}">
                                    <a class="fa fa-times-circle picture-a" style="display:block;" (click)="removePath(pind)"></a>
                                </span>
                                </span>
                                <span *ngIf="imageAd">
                                <span class="picture-list" *ngFor="let img of imageAd;let imgInd = index;">
                                    <img width="90px" height="90px" [src]="img">
                                    <a class="fa fa-times-circle picture-a" style="display:block;" (click)="removeImg(imgInd)"></a>
                                </span>
                                </span>
                                <!--*ngIf="imgCount < 1"-->
                                <div class="picture-list">
                                    <input id="image-input1" class="btn btn-default" type="file" ng2FileSelect [uploader]="uploader" multiple (change)="selectedFileOnChanged()" />
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" (click)="uploadFile()">凭证上传</button>
                        </div>
                    </div>
                    <!--选择退货退款显示-->
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" >退款金额</span>
                                </div>
                                <input class="form-control" type="text" placeholder="请输入退款金额" [(ngModel)]="apply_amount" [ngModelOptions]="{standalone: true}">
                            </div>
                        </div>
                    </div>
                    <!--退货时显示-->
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" >退货物流公司</span>
                                </div>
                                <input class="form-control" type="text" placeholder="物流公司" [(ngModel)]="express_company" [ngModelOptions]="{standalone: true}">
                            </div>
                        </div>

                        <div class="form-group col-md-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" >退货物流单号</span>
                                </div>
                                <input class="form-control" type="text" placeholder="物流单号" [(ngModel)]="express_code" [ngModelOptions]="{standalone: true}">
                            </div>
                        </div>
                    </div>
                    <!--维修换货补寄订单号显示-->
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" >维修换货补寄订单号</span>
                                </div>
                                <input class="form-control" type="text" placeholder="请输入订单号" [(ngModel)]="order_num" [ngModelOptions]="{standalone: true}" >
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" >买家备注</span>
                                </div>
                                <textarea class="form-control" aria-label="备注" [(ngModel)]="buyer_mark" [ngModelOptions]="{standalone: true}"></textarea>
                            </div>
                        </div>
                        <div class="form-group col-md-12">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" >卖家备注</span>
                                </div>
                                <textarea class="form-control" aria-label="备注" [(ngModel)]="seller_mark" [ngModelOptions]="{standalone: true}"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!--保存：审核中  同意、同意并退款：已同意  拒绝：已拒绝 作废：已作废
              同意并退款只有在需要退款的订单才显示  同意退款状态不显示     保存退款状态显示：退款处理中  同意并退款显示：已退款-->
            <div class="modal-footer" *ngIf="verifyInfo?.frozeno_is_verify == 1 || verifyInfo?.frozeno_is_verify == 0">
                <button type="button" class="btn btn-primary" (click)="submitVerify(1)">保存</button>
                <button type="button" class="btn btn-primary" (click)="submitVerify(2)">同意</button>
                <button type="button" class="btn btn-danger" (click)="submitVerify(3)">拒绝</button>
            </div>
        </div>
    </div>
</div>